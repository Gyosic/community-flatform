# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 프로젝트 개요

이 프로젝트는 **셀프 호스팅 커뮤니티 플랫폼**(네이버 카페와 유사)으로, WordPress나 Discourse처럼 설치 후 관리자가 코드 수정 없이 자유롭게 커스터마이징할 수 있는 소프트웨어입니다. 각 빌드된 인스턴스는 하나의 커뮤니티를 운영하며, 관리자는 설정을 통해 모든 것을 제어합니다.

## 핵심 아키텍처 원칙

### 1. 설정 기반 설계 (Configuration-Driven)

모든 기능은 하드코딩이 아닌 설정으로 구동됩니다. 관리자는 코드가 아닌 설정을 통해 동작을 제어합니다.

### 2. 단일 인스턴스 아키텍처

- 각 배포는 하나의 커뮤니티만 운영
- 데이터베이스는 해당 인스턴스의 커뮤니티 전용
- 설정은 환경변수 + 데이터베이스에 저장
- 향후 확장성을 위해 설계는 유연하게 유지

### 3. 수정이 아닌 확장

- 기능은 수정이 아닌 추가로 구현
- JSONB를 활용한 유연한 설정 저장 (layout_config, board_config 등)
- UI 컴포넌트는 교체·숨김·순서 변경 가능해야 함

### 4. 역할 기반 접근 제어 (RBAC)

- 세분화된 권한: Role + Permission 시스템
- 게시판별 권한: 읽기/쓰기/댓글/공지
- 레벨업 조건 설정 가능 (글 수, 댓글 수 등)

## 기술 스택

- **프레임워크**: Next.js (App Router)
- **UI**: shadcn/ui + Tailwind CSS
- **데이터베이스**: PostgreSQL (데이터 정합성)
- **마이그레이션**: drizzle (postgreSQL 마이그레이션 및 조회 클라이언트)
- **캐시/실시간/큐**: Redis (세션, 캐싱, 실시간 기능)
- **언어**: TypeScript
- **인증**: 확장 가능한 구조 (NextAuth 또는 커스텀)

## 데이터베이스 설계 가이드라인

### 기본 테이블 구조

```typescript
// 주요 엔티티는 다음과 같은 구조:
{
  id: string;
  created_at: timestamp;
  updated_at: timestamp;
  // ... 엔티티별 필드
}
```

### 설정 저장 방식

PostgreSQL JSONB를 활용한 유연한 설정:

- `site_settings.layout_config` - 헤더/푸터/메뉴 구성
- `site_settings.theme_config` - 색상, 다크모드, 버튼 스타일
- `site_settings.permission_config` - 역할 정의 및 권한
- `boards.board_config` - 익명, 댓글, 첨부파일 설정

### 데이터 분리

- PostgreSQL: 진실의 원천(Source of Truth), 관계 무결성
- Redis: 세션 관리, 캐싱, 실시간 알림

## 커뮤니티 기능

설치된 인스턴스는 다음을 제공합니다:

- 커스텀 스킨/테마 설정
- 커스텀 메뉴 구조
- 커스텀 게시판 계층
- 회원 등급 및 권한 시스템
- 알림/공지 정책
- 선택적 AI 기능
- 관리자 대시보드

## 관리자 커스터마이징 범위

관리자는 UI를 통해 설정 (코드 수정 불필요):

### 스타일

#### 1. 기본 전제
- Framework: Next.js App Router
- UI Library: shadcn/ui
- Styling: Tailwind CSS
- 대상 서비스: 네이버 카페처럼 관리자가 운영하는 커뮤니티 플랫폼

#### 2. 디자인 목표
- 화려함 ❌
- 안정성, 가독성, 확장성 ✅
- 관리자/일반 사용자 UI를 동시에 커버

#### 3. 스타일 원칙
1. 모든 색상은 CSS 변수로 정의
2. 컬러는 의미 기반 (primary, secondary, danger, muted)
3. radius / spacing / font-size는 토큰화
4. 컴포넌트는 shadcn 기본을 최대한 유지
5. Tailwind arbitrary value 금지

#### 4. 레이아웃 규칙
- 전체 레이아웃은 다음 3단 패턴만 사용
  - Dashboard Layout
  - Content Layout
  - Admin Layout
- Grid / Flex 혼용 금지 (페이지 단위로 통일)

#### 5. 컴포넌트 역할 정의
- Button: action trigger
- Card: content grouping
- Table: data management
- Dialog: destructive or confirm action only
- Tabs: 동일 컨텍스트 내 전환만 허용

#### 6. 관리자 UI 규칙
- 정보 밀도 ↑
- 색상 사용 최소화
- 아이콘은 상태 표현에만 사용

#### 7. 사용자 UI 규칙
- 읽기 중심
- 버튼 대비 강조
- 시선 흐름은 위 → 아래

#### 8. 산출물 요구
1. Tailwind theme 확장 코드
2. shadcn component 사용 규칙
3. 관리자 / 사용자 페이지 예시 레이아웃
4. 절대 하지 말아야 할 디자인 패턴

디자인을 “스크린샷”이 아니라
“재사용 가능한 규칙”으로 설명하십시오.

### 레이아웃

- 헤더/푸터 표시 여부
- 좌측 사이드바 vs 상단 네비게이션
- 홈페이지 블록 순서

### 게시판

- 게시판 생성/삭제
- 게시판 타입: 일반, Q&A, 갤러리, 공지
- 익명 게시 허용 토글
- 댓글/대댓글 설정
- 첨부파일 정책

### 권한

- 역할: 시스템관리자, 관리자, 운영진, 일반회원, 신규회원
- 게시판별 권한: 읽기/쓰기/댓글/공지
- 레벨업 기준

### 테마/UI

- 컬러 프리셋
- 다크모드 기본값
- 버튼 스타일
- 게시글 카드 레이아웃

## 개발 가이드라인

### 기능 추가 시 필수 질문

항상 다음 질문에 답해야 합니다:

1. **확장 포인트**: 기존 코드 수정 없이 어떻게 확장 가능한가?
2. **관리자 제어**: 관리자가 UI에서 어떻게 설정하는가?
3. **설정 분리**: 하드코딩이 아닌 설정으로 제어 가능한가?
4. **플러그인 가능성**: 향후 플러그인으로 전환 가능한가?

### 금지 패턴

- 특정 커뮤니티명이나 URL에 하드코딩된 로직
- 페이지별 if/else 난립
- 설정 없이 동작하는 UI 컴포넌트
- 역할 체계를 무시한 권한 처리

### 필수 패턴

- 설정 기반 UI 렌더링
- 모든 데이터 접근 시 권한 체크
- 상속이 아닌 컴포지션을 통한 확장성
- 환경변수와 DB 설정의 명확한 분리

## 코드 구성 전략

기능 구현 시 다음 순서를 따릅니다:

1. **설계**: 확장 포인트와 설정 스키마 정의
2. **데이터 모델**: JSONB 설정을 활용한 유연한 PostgreSQL 스키마
3. **API**: 권한 검사를 포함한 안전한 엔드포인트
4. **UI**: 설정 기반 컴포넌트 + 관리자 컨트롤
5. **확장성**: 플러그인 훅과 오버라이드 메커니즘

## 개발 커맨드

(프로젝트 구조가 확립되면 추가 예정)

## 기대 결과

이 플랫폼은 다음을 지원해야 합니다:

- 간단한 설치 프로세스 (Docker 또는 전통적 배포)
- 초기 설정 마법사를 통한 기본 구성
- 관리자 패널을 통한 완전한 커스터마이징
- 플러그인 시스템을 통한 기능 확장
- 백업/복원 및 마이그레이션 도구
- 성능 모니터링 및 최적화 옵션
